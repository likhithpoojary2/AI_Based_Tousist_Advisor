{% extends "base.html" %}
{% block body %}

        <section class="page-header">
            <div class="page-header__bg" style="background-image: url(../static/assets/images/backgrounds/page-header-bg-1-1.jpg);"></div><!-- /.page-header__bg -->
            <div class="container">
                <div class="page-header__content">
                    <h2 class="page-header__title bw-split-in-right">destination Details</h2>
                    <ul class="gotur-breadcrumb list-unstyled">
                        <li><a href="/">Home</a></li>
                        <li><span>destination Details</span></li>
                    </ul><!-- /.thm-breadcrumb list-unstyled -->
                </div><!-- /.page-header__content -->
            </div><!-- /.container -->
        </section><!-- /.page-header -->

        <section class="destination-details section-space">
            <div class="container">
                <div class="destination-carousel">
                    <div class="destination-carousel__inner gotur-owl__carousel gotur-owl__carousel--basic-nav owl-carousel owl-theme" data-owl-options='{
                "items": 1,
                "margin": 30,
                "loop": true,
                "smartSpeed": 700,
                "nav": true,
                "navText": ["<span class=\"icon-arrow-left\"></span>","<span class=\"icon-arrow-right\"></span>"],
                "dots": false,
                "autoplay": false
            }'>
                        <div class="item">
                            <div class="destination-carousel__item">
                                <img src="{{destination.imageUrl}}" alt="destination">
                            </div><!-- /.destination-carousel__item -->
                        </div><!-- /.item -->

                        
                        {% for img in ai_data.images %}
                        <div class="item">
                            <div class="destination-carousel__item">
                                <img src="{{ img }}" alt="destination">
                            </div><!-- /.destination-carousel__item -->
                        </div><!-- /.item -->

                        {% endfor %}
                      
                    </div><!-- /.destination-carousel__inner -->
                </div><!-- /.destination-carousel -->
                <div class="row gutter-y-30">
                    <div class="col-lg-8">
                        <div class="destination-details__content">

                            <div class="destination-details__content__item">
                                
                            <h3 class="sec-title__title bw-split-in-left">{{destination.name}} </h3>
                            <h4 class="sec-title__title bw-split-in-left"><span> Overview</span></h4>
                                


                          
                                <p class="destination-details__text wow fadeInUp" data-wow-duration='1500ms' data-wow-delay='500ms'>{{ai_data.overview}}</p><!-- /.destination-details__text -->
                            </div><!-- /.destination-details__content__item -->

                            <div class="destination-details__content__item" style="margin-bottom:-10px">
                                <h3 class="sec-title__title bw-split-in-left"><span> Places to Visit</span></h3>
                               
                            </div>

                            <section class="tour-listing-page section-space">
                                <div class="container">
                                    <div class="row gutter-y-30 gutter-x-30">


                                        {% for place in ai_data.places_to_visit %}
                                        <div class="col-lg-6 col-md-6">
                                            <div class="listing-card-four wow fadeInUp" data-wow-duration='1500ms' data-wow-delay='100ms'>
                                                <div class="listing-card-four__image">
                                                    {% if place.image_url %}
                                                    <img src="{{ place.image_url }}" alt="{{ place.place_name }}" style="height:300px;">
                                                    {% else %}
                                                    <img src="../static/assets/alt.jpeg" alt="{{ place.place_name }}" style="height:300px;">
                                                {% endif %}
                                                    <div class="listing-card-four__btn-group">
                    
                    
                                                        <div class="listing-card-four__featured">Featured</div><!-- /.listing-card-four__featured -->
                    
                                                    </div><!-- /.listing-card-four__btn-group -->
                                 
                                                    </div>
                                                   
                                                    <a href="#" class="listing-card-four__image__overly"></a>
                                                </div><!-- /.listing-card-four__image -->
                                                <div class="listing-card-four__content">
                                                   
                                                    <h3 class="listing-card-four__title"><a href="#">{{ place.place_name }}</a></h3><!-- /.listing-card-four__title -->
                                                    <p>{{ place.place_description }}</p>
                    
                                                  
                                            </div><!-- /.listing-card-four -->
                                        </div><!-- /.col-lg-4 col-md-6 -->
                                        {% endfor %}




                                                                           
                                    </div><!-- /.row -->
                                </div><!-- /.container -->
                            </section><!-- /.tour-listing-page -->




                            <div class="destination-details__content__item" style="margin-bottom:-10px">
                                <h3 class="destination-details__title wow fadeInUp" data-wow-duration='1500ms' data-wow-delay='500ms'>Hotels & Tents</h3><!-- /.destination-details__title -->


                                <h3 class="sec-title__title bw-split-in-left"><span>Hotels & Tents</span></h3>
                           <!-- /.destination-details__text -->
                            </div>
                 

                            <section class="tour-listing-page section-space">
                                <div class="container">
                                    <div class="row gutter-y-30 gutter-x-30">
                                        {% for acc in ai_data.accommodations %}
                                        <div class="col-xl-6 col-lg-4 col-md-6 col-sm-12">
                                            <div class="listing-card-four wow fadeInUp" data-wow-duration='1500ms' data-wow-delay='100ms'>
                            
                                                <!-- Image Section -->
                                                <div class="listing-card-four__image">
                                                    {% if acc.image_url %}
                                                    <img src="{{ acc.image_url }}" alt="{{ acc.accommodation_name }}" 
                                                        style="height:300px; width:100%; border-radius:10px;">
                                                    {% else %}
                                                    <img src="../static/images/hotel.jpeg" alt="{{ acc.accommodation_name }}" 
                                                    style="height:300px; width:100%; border-radius:10px;">
                                                    {% endif %}
                            
                                                    <!-- Featured Type -->
                                                    <div class="listing-card-four__btn-group">
                                                        <div class="listing-card-four__featured">({{ acc.type }})</div>
                                                    </div>
                                                </div> <!-- /.listing-card-four__image -->
                            
                                                <!-- Accommodation Details -->
                                                <div class="listing-card-four__content">
                                                    <ul class="listing-card-four__meta list-unstyled">
                                                        <li>
                                                            <a href="#"> 
                                                                <span class="listing-card-four__meta__icon"> 
                                                                    <i class="icon-pin1"></i> 
                                                                </span> {{ acc.accommodation_name }}
                                                            </a>
                                                        </li>
                                                    </ul>
                                                    <a href="#" class="listing-card-four__image__overly"></a>
                                                </div> <!-- /.listing-card-four__content -->
                            
                                            </div> <!-- /.listing-card-four -->
                                        </div> <!-- /.col-xl-4 col-lg-4 col-md-6 col-sm-12 -->
                                        {% endfor %}
                                    </div> <!-- /.row -->
                                </div> <!-- /.container -->
                            </section> <!-- /.tour-listing-page -->
                            
                            <div class="destination-details__content__thumb wow fadeInUp" data-wow-duration="1500ms" data-wow-delay="500ms">
                                <div class="row gutter-y-30">
                                </div><!-- /.row -->
                            </div><!-- /.destination-details__content__thumb -->
                            
                            <div class="destination-details__content__faq destination-details__content__item" onclick="fetchTravelData('{{ destination.name }}')">
                                <a href="javascript:void(0);" onclick="fetchTravelData('{{ destination.name }}')">
                                    <h3 class="sec-title__title bw-split-in-left"
                                    data-wow-duration="1500ms" data-wow-delay="500ms" style="color:orange;underline">
                                    Need Routing Guide? Click here
                                    </h3>
                                </a>
                            </div>
                            
                            <div id="travel-info"></div>
                            
                            <script>
                                function fetchTravelData(placeName) {
                                    if (!placeName || placeName.trim() === "") {
                                        console.error("Place name is missing!");
                                        alert("Invalid place name.");
                                        return;
                                    }
                            
                                    // Format place name correctly
                                    const formattedPlace = placeName.toLowerCase().replace(/,\s*/g, "-").replace(/,/g, "-");
                            
                                    // Redirect to the new page with travel data
                                    window.location.href = `/travel-data?place=${encodeURIComponent(formattedPlace)}`;
                                }
                            </script>
                            
                        
                        </div><!-- /.destination-details__content -->
                    </div><!-- /.col-lg-8 -->
                    <div class="col-lg-4">
                        <aside class="destination-details__sidebar">
                            <div class="destination-details__sidebar__item destination-details__sidebar__item-list wow fadeInUp" data-wow-duration='1500ms' data-wow-delay='500ms'>
                                <h4 class="destination-details__sidebar__title wow fadeInUp" data-wow-duration='1500ms' data-wow-delay='500ms'>Some Information</h4><!-- /.destination-details__sidebar__title -->
                                <ul class="destination-details__sidebar__list">
                                    <li>
                                        <p class="destination-details__sidebar__text"> <i class="icon-check-star"></i> County:</p><!-- /.destination-details__sidebar__text -->
                                        <span>{{ destination.name }}</span>
                                    </li>
                                    <li>
                                        <p class="destination-details__sidebar__text"> <i class="icon-check-star"></i>Weather:</p><!-- /.destination-details__sidebar__text -->
                                        <span>{{ destination.weatherType }}</span>
                                    </li>
                                    <!-- <li>
                                        <p class="destination-details__sidebar__text"> <i class="icon-check-star"></i>Per Person:</p>
                                        <span>₹{{ destination.price }}</span>
                                    </li>
                                    <li>
                                        <p class="destination-details__sidebar__text"> <i class="icon-check-star"></i> Nights:</p>
                                        <span>{{ destination.nights }}</span>
                                    </li> -->
                                  
                                </ul>
                            </div><!-- /.destination-details__sidebar__item -->
                           
                        </aside><!-- /.destination-details__sidebar -->
                    </div><!-- /.col-lg-4 -->
                </div><!-- /.row -->



            {#    <section class="tour-listing-page section-space">
                    <div class="container">
                        
                        <div class="row gutter-y-30 gutter-x-30">

                            <h3>Recommended Just for You</h3>



                            <div class="col-lg-4 col-md-6">
                                <div class="listing-card-two wow fadeInUp" data-wow-duration='1500ms' data-wow-delay='100ms'>
                                    <div class="listing-card-two__image">
                                        <img src="assets/images/resources/item-1-1.jpg" alt="All Inclusive Ultimate Circle Island Day with Lunch">
                                        <a href="#" class="listing-card-two__overlay"></a>
                                        <div class="listing-card-two__btn-group">
        
                                            <div class="listing-card-two__discount">-30% Off</div><!-- /.listing-card-two__discount -->
        
        
                                        </div><!-- /.listing-card-two__btn-group -->
                                        <div class="listing-card-two__btns">
                                            <a href="#" class="listing-card-two__popup card__popup" data-gallery-options='{
                            "items": [
                                {
                                    "src": "assets/images/blog/listing-1-1.jpg"
                                },
                                {
                                    "src": "assets/images/blog/listing-1-2.jpg"
                                },
                                {
                                    "src": "assets/images/blog/listing-1-3.jpg"
                                }
                            ],
                            "gallery": {
                                "enabled": true
                            },
                            "type": "image"
                        }'>
                                                <span class="icon-image"></span>
                                            </a>
                                            <a class="video-popup" href="https://www.youtube.com/watch?v=0MuL8fd3pb8"><span class="icon-video"></span></a>
                                        </div>
                                    </div><!-- /.listing-card-two__image -->
                                    <div class="listing-card-two__content">
                                        <div class="listing-card-two__rating">
                                            <span>(10 Review)</span>
                                            <i class="icon-star"></i>
                                            <i class="icon-star"></i>
                                            <i class="icon-star"></i>
                                            <i class="icon-star"></i>
                                            <i class="icon-star"></i>
                                        </div><!-- /.listing-card-two__rating -->
                                        <h3 class="listing-card-two__title"><a href="#">All Inclusive Ultimate Circle Island Day with Lunch</a></h3><!-- /.listing-card-two__title -->
                                        <div class="listing-card-two__content__inner">
                                            <ul class="listing-card-two__meta list-unstyled">
                                                <li>
                                                    <a href="#"> <span class="listing-card-two__meta__icon"> <i class="icon-pin"></i> </span>Europe</a>
                                                </li>
                                                <li>
                                                    <a href="#"> <span class="listing-card-two__meta__icon"> <i class="icon-calendar"></i> </span>6 Days, 3 Night</a>
                                                </li>
                                            </ul><!-- /.listing-card-two__meta -->
                                            <div class="listing-card-two__price">
                                                <h5 class="listing-card-two__price__number">$59.00<span>/Per day</span></h5>
                                                <i class="far fa-heart"></i>
                                            </div><!-- /.listing-card__price -->
                                        </div><!-- /.listing-card-two__content__inner -->
                                    </div><!-- /.listing-card-two__content -->
                                </div><!-- /.listing-card-two -->
                            </div><!-- /.col-lg-4 col-md-6 -->





                          

                        </div><!-- /.row -->
                    </div><!-- /.container -->
                </section><!-- /.tour-listing-page -->
#}

<br></br>
<div class="row gutter-y-30 gutter-x-30" id="recommendations">
  
    <h3 class="sec-title__title bw-split-in-left">Recommended Just <span>  for You</span></h3>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const destId = new URLSearchParams(window.location.search).get("dest_id");
        const recommendationsContainer = document.getElementById("recommendations");

        if (!destId) {
            recommendationsContainer.insertAdjacentHTML("beforeend", `<p class="error">No destination ID provided.</p>`);
            return;
        }

        fetch(`/content-recommend?dest_id=${destId}`)
            .then(response => response.json())
            .then(data => {
                if (!data || data.error || !data.recommendations || data.recommendations.length === 0) {
                    recommendationsContainer.insertAdjacentHTML("beforeend", `<p class="error">No recommendations available.</p>`);
                } else {
                    displayRecommendations(data.recommendations);
                }
            })
            .catch(error => {
                console.error("Error fetching recommendations:", error);
                recommendationsContainer.insertAdjacentHTML("beforeend", `<p class="error">Failed to load recommendations.</p>`);
            });
    });

    function displayRecommendations(recommendations) {
        const recommendationsContainer = document.getElementById("recommendations");

        let htmlContent = recommendations.map(rec => `
            <div class="col-lg-4 col-md-6">
                <div class="listing-card-two wow fadeInUp" data-wow-duration="1500ms">
                    <div class="listing-card-two__image">
                        <img src="${rec.imageUrl || 'assets/images/default.jpg'}" alt="${rec.name}">
                        <a href="/destination-details?dest_id=${rec.destination_id}" onclick="event.preventDefault(); saveClick('${rec.destination_id}');" class="listing-card-two__overlay"></a>
                    </div>
                    <div class="listing-card-two__content">
                        <h3 class="listing-card-two__title">
                            <a href="/destination-details?dest_id=${rec.destination_id}" onclick="event.preventDefault(); saveClick('${rec.destination_id}');">
                                ${rec.name}
                            </a>
                        </h3>
                        <p><b>Weather:</b> <i class="fa-solid fa-temperature-half"></i> ${rec.weatherType ? rec.weatherType : "N/A"}</p>
                        <p><b>Budget:</b> <i class="fa-solid fa-tag"></i> ₹${rec.price ? rec.price : "N/A"}</p>
                    </div>
                </div>
            </div>
        `).join('');

        recommendationsContainer.insertAdjacentHTML("beforeend", htmlContent);
    }

    function saveClick(destinationId) {
        fetch('/save_click', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ destination_id: destinationId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                window.location.href = data.redirect_url;  // Redirect on success
            } else {
                console.error("Error:", data.message);
            }
        })
        .catch(error => console.error("Error:", error));
    }
</script>






            </div><!-- /.container -->
        </section><!-- /.destination-details -->
        {% endblock body %}